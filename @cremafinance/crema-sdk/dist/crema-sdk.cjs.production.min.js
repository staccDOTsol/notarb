"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("decimal.js"),n=e(t),r=e(require("tiny-invariant")),i=require("@solana/buffer-layout"),o=require("@solana/web3.js"),a=e(require("bn.js")),u=require("@solana/spl-token"),s=e(require("dotenv"));function c(e,t,i,o,a){e<t||r(!1);var u=v(e),s=v(t);o.greaterThanOrEqualTo(u)&&o.lessThanOrEqualTo(s)||r(!1);var c=new n(1);if(0===a){var l=i.div(c.div(o).sub(c.div(s)));return{desiredAmountDst:l.mul(o.sub(u)),deltaLiquity:l}}var p=i.div(o.sub(u));return{desiredAmountDst:p.mul(c.div(o).sub(c.div(s))),deltaLiquity:p}}function l(e,t,r,i){var o=v(e),a=v(t);return i.lessThan(o)?{amountA:r.div(o).sub(r.div(a)),amountB:new n(0)}:i.greaterThan(a)?{amountA:new n(0),amountB:r.mul(a).sub(r.mul(o))}:{amountA:r.div(i).sub(r.div(a)),amountB:r.mul(i).sub(r.mul(o))}}function p(e,t,i){e<t||r(!1);var o=v(e),a=v(t),u=new n(1);return i.div(u.div(o).sub(u.div(a)))}function f(e,t,n){e<t||r(!1);var i=v(e),o=v(t);return n.div(o.sub(i))}var d=new t.Decimal("1.0001"),h=new t.Decimal("1e-12"),y=d.pow(443632).add(h),m=d.pow(-443632).add(h),w=d.pow(221816).add(h).toDP(12),k=d.pow(-221816).sub(h).toDP(12);function b(e){return e.lessThanOrEqualTo(w)||r(!1),e.greaterThanOrEqualTo(k)||r(!1),e.pow(2).log(d).toDP(0,t.Decimal.ROUND_HALF_UP).toNumber()}function v(e){return e>=-443632&&e<=443632||r(!1),d.pow(e/2)}function g(e){return e.lessThan(y)||r(!1),e.greaterThan(m)||r(!1),e.log(d).toDP(0,t.Decimal.ROUND_HALF_UP).toNumber()}function S(e,t){t>0&&t%1==0||r(!1),e.lessThan(w)||r(!1),e.greaterThan(k)||r(!1);var n=b(e),i=(n- -443632)%t;return i>t/2?n-i+t:n-i}function T(e,t){t>0&&t%1==0||r(!1),e.lessThan(y)||r(!1),e.greaterThan(m)||r(!1);var n=g(e),i=(n- -443632)%t;return i>t/2?n-i+t:n-i}function I(e,n,i,o,a){a.greaterThan(new t.Decimal(0))||r(!1),o.greaterThanOrEqualTo(new t.Decimal(0))||r(!1),e.length>0||r(!1),n>e[0].tickPrice||r(!1);for(var u=o,s=new t.Decimal(0),c=a,l=new t.Decimal(0),p=new t.Decimal(0),f=new t.Decimal(0),d=e.length-1;d>=0;d--)if(u.equals(new t.Decimal(0)))n=e[d].tickPrice.sub(h),u=u.sub(e[d].liquityNet);else if(!(n<e[d].tickPrice)){var y=n,m=e[d].tickPrice,w=x(m,n,u),k=w.mul(i).toDP(0,t.Decimal.ROUND_DOWN);if(l=c.lessThan(k)?c:c.sub(k),w.greaterThanOrEqualTo(l)){var b=O(y,u,l=c.mul(new t.Decimal(1).sub(i)).toDP(0,t.Decimal.ROUND_UP)),v=b.amountOut,g=b.afterSqrtPrice;return f=f.add(c),p=p.add(c.sub(l)),{amountOut:s.add(v),amountUsed:f,feeUsed:p,afterPrice:g,afterLiquity:u}}c=l.sub(w),f=f.add(w).add(k),p=p.add(k),s=s.add(P(m,y,u)),u=u.sub(e[d].liquityNet),n=e[d].tickPrice.sub(h)}return{amountOut:s,amountUsed:f,feeUsed:p,afterPrice:n,afterLiquity:u}}function A(e,n,i,o,a){a.greaterThan(new t.Decimal(0))||r(!1),o.greaterThanOrEqualTo(new t.Decimal(0))||r(!1),e.length>0||r(!1),n.lessThan(e[e.length-1].tickPrice)||r(!1);for(var u=o,s=new t.Decimal(0),c=a,l=new t.Decimal(0),p=new t.Decimal(0),f=new t.Decimal(0),d=0;d<e.length;d++)if(u.equals(new t.Decimal(0)))n=e[d].tickPrice.add(h),u=u.add(e[d].liquityNet);else if(!(n>e[d].tickPrice)){var y=e[d].tickPrice,m=P(n,y,u),w=m.mul(i).toDP(0,t.Decimal.ROUND_DOWN);if(l=c.lessThan(w)?c:c.sub(w),m.greaterThanOrEqualTo(l)){var k=K(n,u,l=c.mul(new t.Decimal(1).sub(i)).toDP(0,t.Decimal.ROUND_UP)),b=k.amountOut,v=k.afterSqrtPrice;return p=p.add(c),f=f.add(c.sub(l)),{amountOut:s.add(b),feeUsed:f,amountUsed:p,afterPrice:v.pow(2),afterLiquity:u}}c=l.sub(m),p=p.add(m).add(w),f=f.add(w),s=s.add(x(n,y,u)),u=u.add(e[d].liquityNet),n=e[d].tickPrice.add(h)}return{amountOut:s,amountUsed:p,feeUsed:f,afterPrice:n,afterLiquity:u}}function x(e,n,r){return r.div(e).toDP(0,t.Decimal.ROUND_DOWN).sub(r.div(n).toDP(0,t.Decimal.ROUND_DOWN))}function P(e,n,r){return r.mul(n.sub(e)).toDP(0,t.Decimal.ROUND_DOWN)}function O(e,n,r){var i=n.div(r.add(n.div(e))),o=r.add(n.div(e).toDP(0,t.Decimal.ROUND_DOWN));return{amountOut:n.mul(e).toDP(0,t.Decimal.ROUND_DOWN).sub(n.mul(n).div(o).toDP(0,t.Decimal.ROUND_DOWN)),afterSqrtPrice:i}}function K(e,n,r){var i=r.div(n).add(e),o=r.add(n.mul(e).toDP(0,t.Decimal.ROUND_DOWN));return{amountOut:n.div(e).toDP(0,t.Decimal.ROUND_DOWN).sub(n.mul(n).div(o).toDP(0,t.Decimal.ROUND_DOWN)),afterSqrtPrice:i}}function B(e,t,n,r,i,o,a){try{var u=e[o](a),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,i)}function D(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){B(o,r,i,a,u,"next",e)}function u(e){B(o,r,i,a,u,"throw",e)}a(void 0)}))}}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function q(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return _(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_(e,void 0):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}n.config({precision:64,rounding:n.ROUND_DOWN,toExpNeg:-64,toExpPos:64});var L,N,E=new n(10),W=new n(2).pow(64),R=W.div(2).sub(1),G=W.div(2).neg(),U=W.sub(1),M=W.pow(63).sub(1),F=M.neg(),C=W.pow(64).sub(1),j=function(){function e(){}return e.from64Buffer=function(e,t){if(void 0===t&&(t=0),8!==e.length&&r(!1),Math.abs(t)<40||r(!1),console.log(e),e[7]>=128){for(var i,o=[],u=q(e);!(i=u()).done;)o.push(("00"+Math.abs(255&~i.value).toString(16)).slice(-2));var s=new a(o.join(""),16,"le").add(new a(1)).neg();return new n(s.toString()).div(E.pow(t))}return new n(new a(e,"le").toString()).div(E.pow(t))},e.fromU64Buffer=function(e,t){return void 0===t&&(t=0),8!==e.length&&r(!1),Math.abs(t)<40||r(!1),new n(new a(e,16,"le").toString()).div(E.pow(t))},e.from128Buffer=function(e,t){if(void 0===t&&(t=0),16!==e.length&&r(!1),Math.abs(t)<40||r(!1),e[15]>=128){for(var i,o=[],u=q(e);!(i=u()).done;)o.push(("00"+Math.abs(255&~i.value).toString(16)).slice(-2));var s=new a(o.join(""),16,"le").add(new a(1)).neg();return new n(s.toString()).div(E.pow(t))}return new n(new a(e,"le").toString()).div(E.pow(t))},e.fromU128Buffer=function(e,t){return void 0===t&&(t=0),16!==e.length&&r(!1),Math.abs(t)<40||r(!1),new n(new a(e,"le").toString()).div(E.pow(t))},e.to64Buffer=function(e,t){void 0===t&&(t=0),Math.abs(t)<40||r(!1),(e=e.mul(E.pow(t)).round()).greaterThanOrEqualTo(G)&&e.lessThanOrEqualTo(R)||r(!1);var n=new a(e.toString());if(n.isNeg()){var i=n.add(new a(1)).toBuffer("le",8);return i.forEach((function(e,t,n){n[t]=255&~e})),i}return n.toBuffer("le",8)},e.toU64Buffer=function(e,t){return void 0===t&&(t=0),Math.abs(t)<40||r(!1),(e=e.mul(E.pow(t)).round()).greaterThanOrEqualTo(0)&&e.lessThanOrEqualTo(U)||r(!1),new a(e.toString()).toBuffer("le",8)},e.to128Buffer=function(e,t){void 0===t&&(t=0),Math.abs(t)<40||r(!1),(e=e.mul(E.pow(t)).round()).greaterThanOrEqualTo(F)&&e.lessThanOrEqualTo(M)||r(!1);var n=new a(e.toString());if(n.isNeg()){var i=n.add(new a(1)).toBuffer("le",16);return i.forEach((function(e,t,n){n[t]=255&~e})),i}return n.toBuffer("le",16)},e.toU128Buffer=function(e,t){return void 0===t&&(t=0),Math.abs(t)<40||r(!1),(e=e.mul(E.pow(t)).round()).greaterThanOrEqualTo(0)&&e.lessThanOrEqualTo(C)||r(!1),new a(e.toString()).toBuffer("le",16)},e}(),z=function(e){return{decode:e.decode.bind(e),encode:e.encode.bind(e)}},V=function(e){void 0===e&&(e="publicKey");var t=i.blob(32,e),n=z(t),r=n.encode,a=n.decode,u=t;return u.decode=function(e,t){var n=a(e,t);return new o.PublicKey(n)},u.encode=function(e,t,n){var i=e.toBuffer();return r(i,t,n)},u},Y=function(e,t){void 0===e&&(e="uint64"),void 0===t&&(t=0);var n=i.blob(8,e),r=n.decode.bind(n),o=n.encode.bind(n),a=n;return a.decode=function(e,n){var i=Buffer.from(r(e,n));return j.fromU64Buffer(i,t)},a.encode=function(e,n,r){var i=j.toU64Buffer(e,t);return o(i,n,r)},a},H=function(e,t){void 0===e&&(e="uint64"),void 0===t&&(t=0);var n=i.blob(16,e),r=n.decode.bind(n),o=n.encode.bind(n),a=n;return a.decode=function(e,n){var i=Buffer.from(r(e,n));return j.from128Buffer(i,t)},a.encode=function(e,n,r){var i=j.to128Buffer(e,t);return o(i,n,r)},a},X=function(e,t){void 0===e&&(e="uint64"),void 0===t&&(t=0);var n=i.blob(16,e),r=n.decode.bind(n),o=n.encode.bind(n),a=n;return a.decode=function(e,n){var i=Buffer.from(r(e,n));return j.fromU128Buffer(i,t)},a.encode=function(e,n,r){var i=j.toU128Buffer(e,t);return o(i,n,r)},a},Z=i.struct([V("nftTokenId"),i.s32("lowerTick"),i.s32("upperTick"),X("liquity"),X("feeGrowthInsideALast",16),X("feeGrowthInsideBLast",16),X("tokenAFee",16),X("tokenBFee",16)],"position"),Q=i.struct([i.u8("swapVersion"),V("tokenSwapKey"),i.u8("accountType"),i.s32("len"),i.blob(359962,"dataFlat")],"positionsAccount"),J=Math.floor(359962/Z.span),$=function(e){return 2===e.data.readUInt8(33)},ee=function(e,t){if($(t)){var n=Buffer.from(t.data),r=Q.decode(n),o=r.swapVersion,a=r.tokenSwapKey,u=r.accountType,s=r.len,c=r.dataFlat.slice(0,s*Z.span);return{pubkey:e,info:t,data:{swapVersion:o,tokenSwapKey:a,accountType:u,len:s,positions:i.seq(Z,s).decode(c)}}}},te=i.struct([i.s32("tick"),X("tickPrice",12),X("liquityGross"),H("liquityNet"),X("feeGrowthOutside0",16),X("feeGrowthOutside1",16)],"tickInfo"),ne=function(e){return 1===e.data.readUInt8(33)},re=function(e,t){if(ne(t)){var n=i.struct([i.u8("swapVersion"),V("tokenSwapKey"),i.u8("accountType"),i.s32("len"),i.blob(t.data.length-38,"dataFlat")],"ticksAccount"),r=Buffer.from(t.data),o=n.decode(r),a=o.swapVersion,u=o.tokenSwapKey,s=o.accountType,c=o.len,l=o.dataFlat.slice(0,c*te.span);return{pubkey:e,info:t,data:{swapVersion:a,tokenSwapKey:u,accountType:s,len:c,ticks:i.seq(te,c).decode(l)}}}},ie=i.struct([i.u8("version"),V("tokenSwapKey"),i.u8("accountType"),i.u8("isInitialized"),i.u8("nonce"),V("tokenProgramId"),V("manager"),V("managerTokenA"),V("managerTokenB"),V("swapTokenA"),V("swapTokenB"),V("tokenAMint"),V("tokenBMint"),V("ticksKey"),V("positionsKey"),i.u8("curveType"),Y("fee",12),Y("managerFee",12),i.u32("tickSpace"),X("currentSqrtPrice",12),X("currentLiquity"),X("feeGrowthGlobal0",16),X("feeGrowthGlobal1",16),X("managerFeeA"),X("managerFeeB")],"tokenSwapAccount"),oe=ie.span,ae=function(e){return 0===e.data.readUInt8(33)},ue=function(e,t){if(ae(t)){var n=Buffer.from(t.data);return{pubkey:e,info:t,data:ie.decode(n)}}},se=(function(e){var t=function(e){var t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function s(e,t,n,r){var i=Object.create((t&&t.prototype instanceof p?t:p).prototype),o=new T(r||[]);return i._invoke=function(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return{value:void 0,done:!0}}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var u=v(a,n);if(u){if(u===l)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=c(e,t,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===l)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}(e,n,o),i}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=s;var l={};function p(){}function f(){}function d(){}var h={};u(h,i,(function(){return this}));var y=Object.getPrototypeOf,m=y&&y(y(I([])));m&&m!==t&&n.call(m,i)&&(h=m);var w=d.prototype=p.prototype=Object.create(h);function k(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){var r;this._invoke=function(i,o){function a(){return new t((function(r,a){!function r(i,o,a,u){var s=c(e[i],e,o);if("throw"!==s.type){var l=s.arg,p=l.value;return p&&"object"==typeof p&&n.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,a,u)}),(function(e){r("throw",e,a,u)})):t.resolve(p).then((function(e){l.value=e,a(l)}),(function(e){return r("throw",e,a,u)}))}u(s.arg)}(i,o,r,a)}))}return r=r?r.then(a,a):a()}}function v(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,v(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=c(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,l;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function g(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(g,this),this.reset(!0)}function I(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:A}}function A(){return{value:void 0,done:!0}}return f.prototype=d,u(w,"constructor",d),u(d,"constructor",f),f.displayName=u(d,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,u(e,a,"GeneratorFunction")),e.prototype=Object.create(w),e},e.awrap=function(e){return{__await:e}},k(b.prototype),u(b.prototype,o,(function(){return this})),e.AsyncIterator=b,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new b(s(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},k(w),u(w,a,"Generator"),u(w,i,(function(){return this})),u(w,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=I,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),s=n.call(o,"finallyLoc");if(u&&s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;S(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:I(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}(N={exports:{}}),N.exports);!function(e){e[e.Initialize=0]="Initialize",e[e.Swap=1]="Swap",e[e.DepositAllTokenTypes=2]="DepositAllTokenTypes",e[e.WithdrawAllTokenTypes=3]="WithdrawAllTokenTypes",e[e.Claim=4]="Claim",e[e.ManagerClaim=5]="ManagerClaim",e[e.AddUserPosition=6]="AddUserPosition",e[e.UpdateFee=7]="UpdateFee",e[e.SimulateSwap=8]="SimulateSwap"}(L||(L={}));var ce=i.struct([i.u8("instruction")]),le=i.struct([i.u8("instruction"),Y("positionIndex")]),pe=function(e,t,n,r,i,a,s,c,l,p,f,d,h){var y=Buffer.alloc(le.span);return le.encode({instruction:L.Claim,positionIndex:h},y),new o.TransactionInstruction({keys:[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1}],programId:e,data:y})},fe=i.struct([i.u8("instruction"),i.u8("isNewPosition"),X("liquityAmount"),i.s32("tickLower"),i.s32("tickUpper"),Y("maximumTokenA"),Y("maximumTokenB"),Y("positionIndex")]),de=function(e,t,n,r,i,a,s,c,l,p,f,d,h,y,m,w,k,b,v){var g=Buffer.alloc(fe.span);return fe.encode({instruction:L.DepositAllTokenTypes,isNewPosition:h,liquityAmount:w,tickLower:y,tickUpper:m,maximumTokenA:k,maximumTokenB:b,positionIndex:v},g),new o.TransactionInstruction({keys:[{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1}],programId:e,data:g})},he=i.struct([i.u8("instruction"),i.u8("nonce"),i.u8("curveType"),Y("fee",12),Y("managerFee",12),i.u32("tickSpace"),X("currentSqrtPrice",12),X("currentLiquity"),X("feeGrowthGlobal0"),X("feeGrowthGlobal1"),X("managerFeeA"),X("managerFeeB")]),ye=function(e,t,r,i,a,s,c,l,p,f,d,h,y,m,w,k){var b=Buffer.alloc(he.span);return he.encode({instruction:L.Initialize,nonce:d,curveType:h,fee:y,managerFee:m,tickSpace:w,currentSqrtPrice:k,currentLiquity:new n(0),feeGrowthGlobal0:new n(0),feeGrowthGlobal1:new n(0),managerFeeA:new n(0),managerFeeB:new n(0)},b),new o.TransactionInstruction({keys:[{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:u.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1}],programId:e,data:b})},me=i.struct([i.u8("instruction")]),we=function(e,t,n,r,i,a,s,c){var l=Buffer.alloc(me.span);return me.encode({instruction:L.ManagerClaim},l),new o.TransactionInstruction({keys:[{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1}],programId:e,data:l})},ke=i.struct([i.u8("instruction"),Y("amountIn"),i.u8("direction")]),be=function(e,t,n,r,i){var a=Buffer.alloc(ke.span);return ke.encode({instruction:L.SimulateSwap,amountIn:r,direction:i},a),new o.TransactionInstruction({keys:[{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0}],programId:e,data:a})},ve=i.struct([i.u8("instruction"),Y("amountIn"),Y("minimumAmountOut")]),ge=function(e,t,n,r,i,a,s,c,l,p,f){var d=Buffer.alloc(ve.span);return ve.encode({instruction:L.Swap,amountIn:p,minimumAmountOut:f},d),new o.TransactionInstruction({keys:[{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:u.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1}],programId:e,data:d})},Se=i.struct([i.u8("instruction"),Y("liquityAmount"),Y("minimumTokenA"),Y("minimumTokenB"),Y("positionIndex")]),Te=function(e,t,n,r,i,a,s,c,l,p,f,d,h,y,m,w){var k=Buffer.alloc(Se.span);return Se.encode({instruction:L.WithdrawAllTokenTypes,liquityAmount:h,minimumTokenA:y,minimumTokenB:m,positionIndex:w},k),new o.TransactionInstruction({keys:[{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1}],programId:e,data:k})};function Ie(){if(s.config(),process.env.LIVE){switch(process.env.CLUSTER){case"devnet":case"testnet":case"mainnet-beta":return process.env.CLUSTER}throw'Unknown cluster "'+process.env.CLUSTER+'", check the .env file'}}var Ae=Ie(),xe=process.env.RPC_URL||(process.env.LIVE?o.clusterApiUrl(Ae,!1):"http://localhost:8899"),Pe=process.env.RPC_URL||(process.env.LIVE?o.clusterApiUrl(Ae,!0):"http://localhost:8899"),Oe=process.env.WALLET_URL||"https://solana-example-webwallet.herokuapp.com/";function Ke(e,t){return Be.apply(this,arguments)}function Be(){return(Be=D(se.mark((function e(t,n){var r,i,a,u=arguments;return se.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=u.length,i=new Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=u[a];return e.abrupt("return",o.sendAndConfirmTransaction(t,n,i,{skipPreflight:!1,commitment:"recent",preflightCommitment:"recent"}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function De(e,t){return _e.apply(this,arguments)}function _e(){return(_e=D(se.mark((function e(t,n){return se.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.Token.getAssociatedTokenAddress(u.ASSOCIATED_TOKEN_PROGRAM_ID,u.TOKEN_PROGRAM_ID,t,n,!0);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qe(e,t,n,r){return u.Token.createAssociatedTokenAccountInstruction(u.ASSOCIATED_TOKEN_PROGRAM_ID,u.TOKEN_PROGRAM_ID,e,t,n,r)}function Le(){return(Le=D(se.mark((function e(t,n){var i,o;return se.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getAccountInfo(n);case 2:return null===(null==(i=e.sent)?void 0:i.data)&&r(!1),null===i&&r(!1),(o=We(i)).address=n,e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ne(e,t){return Ee.apply(this,arguments)}function Ee(){return(Ee=D(se.mark((function e(t,n){var i,o,a,s,c,l,p;return se.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getTokenAccountsByOwner(n,{programId:u.TOKEN_PROGRAM_ID});case 2:for(i=e.sent,o=[],a=0;a<i.value.length;a++)c=(s=i.value[a]).pubkey,null===(null==(l=s.account)?void 0:l.data)&&r(!1),(p=We(l)).address=c,o.push(p);return e.abrupt("return",o);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function We(e){null===(null==e?void 0:e.data)&&r(!1);var t=u.AccountLayout.decode(null==e?void 0:e.data);return t.mint=new o.PublicKey(t.mint),t.owner=new o.PublicKey(t.owner),t.amount=u.u64.fromBuffer(t.amount),0===t.delegateOption?(t.delegate=null,t.delegatedAmount=new u.u64(0)):(t.delegate=new o.PublicKey(t.delegate),t.delegatedAmount=u.u64.fromBuffer(t.delegatedAmount)),t.isInitialized=0!==t.state,t.isFrozen=2===t.state,1===t.isNativeOption?(t.rentExemptReserve=u.u64.fromBuffer(t.isNative),t.isNative=!0):(t.rentExemptReserve=null,t.isNative=!1),t.closeAuthority=0===t.closeAuthorityOption?null:new o.PublicKey(t.closeAuthority),t}var Re=new o.PublicKey("11111111111111111111111111111111");n.config({precision:64,rounding:n.ROUND_HALF_DOWN,toExpNeg:-64,toExpPos:64});var Ge=function(){function e(e,t,r,i){this.programId=Re,this.tokenSwapKey=Re,this.authority=Re,this.isLoaded=!1,this.currentTick=0,this.tokenSwapInfo={tokenSwapKey:Re,accountType:0,version:0,isInitialized:0,nonce:0,tokenProgramId:u.TOKEN_PROGRAM_ID,manager:Re,managerTokenA:Re,managerTokenB:Re,swapTokenA:Re,swapTokenB:Re,tokenAMint:Re,tokenBMint:Re,ticksKey:Re,positionsKey:Re,curveType:0,fee:new n(0),managerFee:new n(0),tickSpace:0,currentSqrtPrice:new n(0),currentLiquity:new n(0),feeGrowthGlobal0:new n(0),feeGrowthGlobal1:new n(0),managerFeeA:new n(0),managerFeeB:new n(0)},this.ticks=[],this.conn=e,this.tokenSwapKey=r,this.programId=t,this.payer=i,this.positions=new Map,this.positionsKeys=new Map}var t=e.prototype;return t.setDefaultPayer=function(e){this.payer=e},t.load=function(){var e=D(se.mark((function e(){var t,i=this;return se.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={encoding:"base64",filters:[{memcmp:{offset:1,bytes:this.tokenSwapKey.toBase58()}}]},e.next=3,this.conn.getProgramAccounts(this.programId,t);case 3:if(e.sent.map((function(e){if(ae(e.account)){var t=ue(e.pubkey,e.account);void 0===(null==t?void 0:t.data)&&r(!1),i.tokenSwapInfo=t.data}else if(ne(e.account)){var o=re(e.pubkey,e.account);void 0===(null==o?void 0:o.data)&&r(!1),i.ticks=o.data.ticks}else if($(e.account)){var a=ee(e.pubkey,e.account);void 0===(null==a?void 0:a.data)&&r(!1),i.positionsKeys.set(e.pubkey,a.data.positions.length);for(var u=0;u<a.data.positions.length;u++){var s=a.data.positions[u];i.positions.set(s.nftTokenId.toBase58(),{positionsKey:e.pubkey,index:new n(u),positionId:s.nftTokenId,lowerTick:s.lowerTick,upperTick:s.upperTick,liquity:s.liquity,feeGrowthInsideALast:s.feeGrowthInsideALast,feeGrowthInsideBLast:s.feeGrowthInsideBLast,tokenAFee:s.tokenAFee,tokenBFee:s.tokenBFee})}}else console.log("the account:%s length:%d unkown",e.pubkey.toString(),e.account.data.length)})),this.authority.toString()!==Re.toString()){e.next=11;break}return e.next=8,o.PublicKey.findProgramAddress([this.tokenSwapKey.toBuffer()],this.programId);case 8:this.authority=e.sent[0];case 11:return this.isLoaded=!0,this.currentTick=b(this.tokenSwapInfo.currentSqrtPrice),e.abrupt("return",this);case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),e.createTokenSwap=function(){var t=D(se.mark((function t(n,r,i,a,s,c,l,p,f,d,h){var y,m,w,k,b,v,g,S,T,I,A,x,P,O,K,B,D;return se.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===h&&(h=!1),y=o.Keypair.generate(),m=o.Keypair.generate(),w=o.Keypair.generate(),t.next=6,o.PublicKey.findProgramAddress([y.publicKey.toBuffer()],r);case 6:return b=(k=t.sent)[0],v=k[1],t.next=11,n.getMinimumBalanceForRentExemption(504e3);case 11:return g=t.sent,t.next=14,n.getMinimumBalanceForRentExemption(36e4);case 14:return S=t.sent,t.next=17,n.getMinimumBalanceForRentExemption(oe);case 17:return T=t.sent,I=(new o.Transaction).add(o.SystemProgram.createAccount({fromPubkey:d.publicKey,newAccountPubkey:y.publicKey,lamports:T,space:oe,programId:r}),o.SystemProgram.createAccount({fromPubkey:d.publicKey,newAccountPubkey:m.publicKey,lamports:g,space:504e3,programId:r}),o.SystemProgram.createAccount({fromPubkey:d.publicKey,newAccountPubkey:w.publicKey,lamports:S,space:36e4,programId:r})),t.next=21,De(i,b);case 21:return A=t.sent,t.next=24,De(a,b);case 24:return x=t.sent,I.add(qe(i,A,b,d.publicKey),qe(a,x,b,d.publicKey)),P=f.sqrt(),O=new u.Token(n,i,u.TOKEN_PROGRAM_ID,d),K=new u.Token(n,a,u.TOKEN_PROGRAM_ID,d),t.next=31,O.getOrCreateAssociatedAccountInfo(s);case 31:return B=t.sent,t.next=34,K.getOrCreateAssociatedAccountInfo(s);case 34:return I.add(ye(r,y.publicKey,b,s,B.address,t.sent.address,A,x,m.publicKey,w.publicKey,v,0,c,l,p,P)),t.next=39,Ke(n,I,d,y,m,w);case 39:return D=t.sent,h&&console.log(D),t.next=43,new e(n,r,y.publicKey,d).load();case 43:return t.abrupt("return",t.sent);case 44:case"end":return t.stop()}}),t)})));return function(e,n,r,i,o,a,u,s,c,l,p){return t.apply(this,arguments)}}(),t.mintPosition=function(){var e=D(se.mark((function e(t,i,a,s,c,l,p,f,d){var h,y,m,w,k;return se.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===d&&(d=null),!this.isLoaded){e.next=4;break}return e.next=4,this.load();case 4:return a<s||r(!1),null===(d=null!==d?d:this.payer)&&r(!1),h=o.Keypair.generate(),e.next=10,De(h.publicKey,d.publicKey);case 10:return y=e.sent,e.next=13,u.Token.getMinBalanceRentForExemptAccount(this.conn);case 13:return m=e.sent,null===(w=this.choosePosition())&&r(!1),(k=new o.Transaction).add(o.SystemProgram.createAccount({fromPubkey:d.publicKey,newAccountPubkey:h.publicKey,lamports:m,space:u.MintLayout.span,programId:u.TOKEN_PROGRAM_ID}),u.Token.createInitMintInstruction(u.TOKEN_PROGRAM_ID,h.publicKey,0,this.authority,null),qe(h.publicKey,y,d.publicKey,d.publicKey)),k.add(de(this.programId,this.tokenSwapKey,this.authority,f.publicKey,t,i,this.tokenSwapInfo.swapTokenA,this.tokenSwapInfo.swapTokenB,h.publicKey,y,this.tokenSwapInfo.ticksKey,w,0,a,s,c,l,p,new n(0))),e.next=21,Ke(this.conn,k,d,f,h);case 21:return e.abrupt("return",e.sent);case 22:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o,a,u,s,c){return e.apply(this,arguments)}}(),t.increaseLiquity=function(){var e=D(se.mark((function e(t,n,i,a,s,c,l){var p,f,d,h;return se.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===l&&(l=null),this.isLoaded){e.next=4;break}return e.next=4,this.load();case 4:return void 0===(p=this.getPositionInfo(t))&&r(!1),null===(l=null!==l?l:this.payer)&&r(!1),f=new u.Token(this.conn,t,u.TOKEN_PROGRAM_ID,l),e.t0=f,e.next=12,De(f.publicKey,l.publicKey);case 12:return e.t1=e.sent,e.next=15,e.t0.getAccountInfo.call(e.t0,e.t1);case 15:return 1!==(d=e.sent).amount.toNumber()&&r(!1),(h=new o.Transaction).add(de(this.programId,this.tokenSwapKey,this.authority,l.publicKey,n,i,this.tokenSwapInfo.swapTokenA,this.tokenSwapInfo.swapTokenB,t,d.address,this.tokenSwapInfo.ticksKey,p.positionsKey,1,p.lowerTick,p.upperTick,a,s,c,p.index)),e.next=21,Ke(this.conn,h,l);case 21:return e.abrupt("return",e.sent);case 22:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o,a,u){return e.apply(this,arguments)}}(),t.decreaseLiquity=function(){var e=D(se.mark((function e(t,n,i,a,s,c,l){var p,f,d,h;return se.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===l&&(l=null),this.isLoaded){e.next=4;break}return e.next=4,this.load();case 4:return void 0===(p=this.getPositionInfo(t))&&r(!1),null===(l=null!==l?l:this.payer)&&r(!1),f=new u.Token(this.conn,t,u.TOKEN_PROGRAM_ID,l),e.t0=f,e.next=12,De(f.publicKey,l.publicKey);case 12:return e.t1=e.sent,e.next=15,e.t0.getAccountInfo.call(e.t0,e.t1);case 15:return 1!==(d=e.sent).amount.toNumber()&&r(!1),h=(new o.Transaction).add(Te(this.programId,this.tokenSwapKey,this.authority,l.publicKey,this.tokenSwapInfo.swapTokenA,this.tokenSwapInfo.swapTokenB,n,i,t,d.address,this.tokenSwapInfo.ticksKey,p.positionsKey,a,s,c,p.index)),e.next=20,Ke(this.conn,h,l);case 20:return e.abrupt("return",e.sent);case 21:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o,a,u){return e.apply(this,arguments)}}(),t.swap=function(){var e=D(se.mark((function e(t,n,i,a,u,s,c){var l,p,f,d;return se.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===c&&(c=null),this.isLoaded){e.next=4;break}return e.next=4,this.load();case 4:return null===(c=null!==c?c:this.payer)&&r(!1),p=(l=1===i?{swapSrc:this.tokenSwapInfo.swapTokenA,swapDst:this.tokenSwapInfo.swapTokenB}:{swapSrc:this.tokenSwapInfo.swapTokenB,swapDst:this.tokenSwapInfo.swapTokenA}).swapSrc,f=l.swapDst,d=(new o.Transaction).add(ge(this.programId,this.tokenSwapKey,this.authority,s.publicKey,t,n,p,f,this.tokenSwapInfo.ticksKey,a,u)),e.next=10,Ke(this.conn,d,c,s);case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o,a,u){return e.apply(this,arguments)}}(),t.simulateSwap=function(){var e=D(se.mark((function e(t,n,r){var i;return se.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isLoaded){e.next=3;break}return e.next=3,this.load();case 3:return i=(new o.Transaction).add(be(this.programId,this.tokenSwapKey,this.tokenSwapInfo.ticksKey,t,n)),e.next=6,this.conn.simulateTransaction(i,[r]);case 6:console.log(e.sent);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),t.collect=function(){var e=D(se.mark((function e(t,n,i,a){var s,c,l,p;return se.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===a&&(a=null),this.isLoaded){e.next=4;break}return e.next=4,this.load();case 4:return void 0===(s=this.getPositionInfo(t))&&r(!1),null===(a=null!==a?a:this.payer)&&r(!1),c=new u.Token(this.conn,t,u.TOKEN_PROGRAM_ID,a),e.t0=c,e.next=12,De(c.publicKey,a.publicKey);case 12:return e.t1=e.sent,e.next=15,e.t0.getAccountInfo.call(e.t0,e.t1);case 15:return 1!==(l=e.sent).amount.toNumber()&&r(!1),p=(new o.Transaction).add(pe(this.programId,this.tokenSwapKey,this.authority,a.publicKey,this.tokenSwapInfo.swapTokenB,this.tokenSwapInfo.swapTokenB,n,i,t,l.address,this.tokenSwapInfo.ticksKey,s.positionsKey,s.index)),e.next=20,Ke(this.conn,p,a);case 20:return e.abrupt("return",e.sent);case 21:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),t.managerCollect=function(){var e=D(se.mark((function e(t,n,i){var a;return se.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===i&&(i=null),this.isLoaded){e.next=4;break}return e.next=4,this.load();case 4:return null===(i=null!==i?i:this.payer)&&r(!1),a=(new o.Transaction).add(we(this.programId,this.tokenSwapKey,this.authority,i.publicKey,this.tokenSwapInfo.swapTokenA,this.tokenSwapInfo.swapTokenB,t,n)),e.next=9,Ke(this.conn,a,i);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),t.addPositionsAccount=function(){var e=D(se.mark((function e(t){var n,i,a;return se.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===t&&(t=null),this.isLoaded){e.next=4;break}return e.next=4,this.load();case 4:return null===(t=null!==t?t:this.payer)&&r(!1),n=o.Keypair.generate(),e.next=9,this.conn.getMinimumBalanceForRentExemption(36e4);case 9:return i=e.sent,a=(new o.Transaction).add(o.SystemProgram.createAccount({fromPubkey:t.publicKey,newAccountPubkey:n.publicKey,lamports:i,space:36e4,programId:this.programId}),(s=this.programId,c=this.authority,l=n.publicKey,p=Buffer.alloc(ce.span),ce.encode({instruction:L.AddUserPosition},p),new o.TransactionInstruction({keys:[{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:u.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1}],programId:s,data:p}))),e.next=13,Ke(this.conn,a,t,n);case 13:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}var s,c,l,p}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.approve=function(){var e=D(se.mark((function e(t,n,i,o,a){var s;return se.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===a&&(a=null),null===(a=null!==a?a:this.payer)&&r(!1),s=new u.Token(this.conn,n,u.TOKEN_PROGRAM_ID,a),e.next=6,s.approve(t,o.publicKey,a,[],i.toNumber());case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}(),t.getUserPositions=function(){var e=D(se.mark((function e(t){var n,i,o,a,u;return se.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===t&&(t=void 0),this.isLoaded||r(!1),void 0===(t=void 0!==t?t:null==(n=this.payer)?void 0:n.publicKey)&&r(!1),e.next=6,Ne(this.conn,t);case 6:for(i=e.sent,o=[],a=0;a<i.length;a++)void 0!==(u=this.positions.get(i[a].mint.toBase58()))&&o.push(u);return e.abrupt("return",o);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.calculateLiquityByTokenA=function(e,t,i){if(this.isLoaded||r(!1),this.currentTick<=t||r(!1),this.currentTick<e)return{desiredAmountB:new n(0),liquity:p(e,t,i)};var o=c(e,t,i,this.tokenSwapInfo.currentSqrtPrice,0);return{desiredAmountB:o.desiredAmountDst,liquity:o.deltaLiquity}},t.calculateLiquityByTokenB=function(e,t,i){if(this.isLoaded||r(!1),this.currentTick>=e||r(!1),this.currentTick<t)return{desiredAmountA:new n(0),liquity:f(e,t,i)};var o=c(e,t,i,this.tokenSwapInfo.currentSqrtPrice,1);return{desiredAmountA:o.desiredAmountDst,liquity:o.deltaLiquity}},t.calculatePositionValue=function(e){this.isLoaded||r(!1);var t=this.getPositionInfo(e);void 0===t&&r(!1);var n=l(t.lowerTick,t.upperTick,t.liquity,this.tokenSwapInfo.currentSqrtPrice);return{liquity:t.liquity,amountA:n.amountA,amountB:n.amountB}},t.preCollect=function(e){this.isLoaded||r(!1);var t=this.getPositionInfo(e);void 0===t&&r(!1);for(var i=null,o=null,a=0;a<this.ticks.length;a++)this.ticks[a].tick===t.lowerTick&&(i=this.ticks[a]),this.ticks[a].tick===t.upperTick&&(o=this.ticks[a]);null===i&&r(!1),null===o&&r(!1);var u=new n(0),s=new n(0),c=new n(0),l=new n(0),p=this.tokenSwapInfo.currentSqrtPrice;return i.tickPrice.lessThan(p)?(u=i.feeGrowthOutside0,s=i.feeGrowthOutside1):(u=this.tokenSwapInfo.feeGrowthGlobal0.sub(i.feeGrowthOutside0),s=this.tokenSwapInfo.feeGrowthGlobal1.sub(i.feeGrowthOutside1)),o.tickPrice.lessThan(p)?(c=this.tokenSwapInfo.feeGrowthGlobal0.sub(o.feeGrowthOutside0),l=this.tokenSwapInfo.feeGrowthGlobal1.sub(o.feeGrowthOutside1)):(c=o.feeGrowthOutside0,l=o.feeGrowthOutside1),{amountA:this.tokenSwapInfo.feeGrowthGlobal0.sub(u).sub(c).sub(t.feeGrowthInsideALast).mul(t.liquity).add(t.tokenAFee),amountB:this.tokenSwapInfo.feeGrowthGlobal1.sub(s).sub(l).sub(t.feeGrowthInsideBLast).mul(t.liquity).add(t.tokenBFee)}},t.preSwapA=function(e){this.isLoaded||r(!1);var t=I(this.ticks,this.tokenSwapInfo.currentSqrtPrice,this.tokenSwapInfo.fee,this.tokenSwapInfo.currentLiquity,e),i=this.tokenSwapInfo.currentSqrtPrice.pow(2),o=new n(1).div(i),a=t.amountOut.div(t.amountUsed),u=t.amountUsed.div(t.amountOut),s=a.sub(i).div(i).abs(),c=u.sub(o).div(o).abs(),l=t.afterPrice.pow(2),p=new n(1).div(l);return{amountOut:t.amountOut,amountUsed:t.amountUsed,feeUsed:t.feeUsed,afterPriceA:l,afterPriceB:p,afterLiquity:t.afterLiquity,impactA:s,impactB:c,transactionPriceA:a,transactionPriceB:u}},t.preSwapB=function(e){this.isLoaded||r(!1);var t=A(this.ticks,this.tokenSwapInfo.currentSqrtPrice,this.tokenSwapInfo.fee,this.tokenSwapInfo.currentLiquity,e),i=this.tokenSwapInfo.currentSqrtPrice.pow(2),o=new n(1).div(i),a=t.amountUsed.div(t.amountOut),u=t.amountOut.div(t.amountUsed),s=a.sub(i).div(i).abs(),c=u.sub(o).div(o).abs(),l=t.afterPrice.pow(2),p=new n(1).div(l);return{amountOut:t.amountOut,amountUsed:t.amountUsed,feeUsed:t.feeUsed,afterLiquity:t.afterLiquity,impactA:s,impactB:c,transactionPriceA:a,transactionPriceB:u,afterPriceA:l,afterPriceB:p}},t.getNearestTickByPrice=function(e){return this.isLoaded||r(!1),T(e,this.tokenSwapInfo.tickSpace)},t.getPositionInfo=function(e){return this.isLoaded||r(!1),this.positions.get(e.toBase58())},t.choosePosition=function(){this.isLoaded||r(!1);for(var e,t=q(this.positionsKeys);!(e=t()).done;){var n=e.value;if(n[1]<J)return n[0]}return null},t.log=function(){var e=null!==this.payer?this.payer.publicKey.toBase58():"null";console.log(JSON.stringify({programId:this.programId.toString(),tokenSwapKey:this.tokenSwapKey.toString(),payer:e,authority:this.authority.toString(),currentTick:this.currentTick,currentPrice:this.tokenSwapInfo.currentSqrtPrice.pow(2).toString(),tokenSwapInfo:{accountType:this.tokenSwapInfo.accountType,version:this.tokenSwapInfo.version,isInitialized:this.tokenSwapInfo.isInitialized,nonce:this.tokenSwapInfo.nonce,manager:this.tokenSwapInfo.manager.toString(),managerTokenA:this.tokenSwapInfo.managerTokenA.toString(),managerTokenB:this.tokenSwapInfo.managerTokenB.toString(),swapTokenA:this.tokenSwapInfo.swapTokenA.toString(),swapTokenB:this.tokenSwapInfo.swapTokenB.toString(),tokenAMint:this.tokenSwapInfo.tokenAMint.toString(),tokenBMint:this.tokenSwapInfo.tokenBMint.toString(),ticksKey:this.tokenSwapInfo.ticksKey.toString(),positionsKey:this.tokenSwapInfo.positionsKey.toString(),curveType:this.tokenSwapInfo.curveType,fee:this.tokenSwapInfo.fee,managerFee:this.tokenSwapInfo.managerFee,tickSpace:this.tokenSwapInfo.tickSpace,currentSqrtPrice:this.tokenSwapInfo.currentSqrtPrice,currentLiquity:this.tokenSwapInfo.currentLiquity,feeGrowthGlobal0:this.tokenSwapInfo.feeGrowthGlobal0,feeGrowthGlobal1:this.tokenSwapInfo.feeGrowthGlobal1,managerFeeA:this.tokenSwapInfo.managerFeeA,managerFeeB:this.tokenSwapInfo.managerFeeB},positions:Object.fromEntries(this.positions),positionsKeys:Object.fromEntries(this.positionsKeys),ticks:this.ticks},null,4))},e}();exports.INIT_KEY=Re,exports.MAX_ACCOUNT_POSITION_LENGTH=J,exports.MAX_PRICE=y,exports.MAX_SQRT_PRICE=w,exports.MAX_TICK=443632,exports.MIN_PRICE=m,exports.MIN_SQRT_PRICE=k,exports.MIN_TICK=-443632,exports.PIECES=d,exports.POSITIONS_ACCOUNT_SIZE=36e4,exports.POSITIONS_ACCOUNT_TYPE=2,exports.PRICE_OFFSET=h,exports.PositionLayout=Z,exports.PositionsAccountLayout=Q,exports.TICKS_ACCOUNT_SIZE=504e3,exports.TICKS_ACCOUNT_TYPE=1,exports.TOKEN_SWAP_ACCOUNT_SIZE=oe,exports.TOKEN_SWAP_ACCOUNT_TYPE=0,exports.TickLayout=te,exports.TokenSwap=Ge,exports.TokenSwapAccountLayout=ie,exports.calculateLiquity=c,exports.calculateLiquityOnlyA=p,exports.calculateLiquityOnlyB=f,exports.calculateLiquityTable=function(e){for(var t=new n(0),r=new n(0),i=[],o={lowerTick:0,upperTick:0,amount:new n(0)},a=0;a<e.length;a++)o.amount.equals(0)?(o.lowerTick=e[a].tick,o.amount=e[a].liquityNet):(o.upperTick=e[a].tick,t=o.amount.lessThan(t)||t.equals(0)?o.amount:t,r=o.amount.greaterThan(r)?o.amount:r,i.push({lowerTick:o.lowerTick,upperTick:o.upperTick,amount:o.amount}),o.amount=o.amount.add(e[a].liquityNet),o.lowerTick=e[a].tick);return{maxLiquity:r,minLiquity:t,liquitys:i}},exports.calculateSlidTokenAmount=function(e,t,i,o,a){a.lessThan(1)&&a.greaterThan(0)||r(!1);var u=o.mul(new n(1).add(a).sqrt()),s=o.mul(new n(1).sub(a).sqrt()),c=l(e,t,i,o),p=l(e,t,i,s),f=l(e,t,i,u);return{maxAmountA:p.amountA,minAmountA:f.amountA,maxAmountB:f.amountB,minAmountB:p.amountB,amountA:c.amountA,amountB:c.amountB}},exports.calculateSwapA2B=I,exports.calculateSwapB2A=A,exports.calculateTokenAmount=l,exports.cluster=Ae,exports.createAssociatedTokenAccountInstruction=qe,exports.decimal128=H,exports.decimal64=function(e,t){void 0===e&&(e="uint64"),void 0===t&&(t=0);var n=i.blob(8,e),r=n,o=n.decode.bind(n),a=n.encode.bind(n);return r.decode=function(e,n){var r=Buffer.from(o(e,n));return j.from64Buffer(r,t)},r.encode=function(e,n,r){var i=j.to64Buffer(e,t);return a(i,n,r)},r},exports.decimalU128=X,exports.decimalU64=Y,exports.encodeDecode=z,exports.getAssociatedTokenAddress=De,exports.getNearestTick=function(e,t){return S(e,t)},exports.getNearestTickByPrice=T,exports.getNearestTickBySqrtPrice=S,exports.getTokenAccount=function(e,t){return Le.apply(this,arguments)},exports.getTokenAccounts=Ne,exports.int128=function(e){return void 0===e&&(e="uint128"),i.blob(16,e)},exports.int64=function(e){return void 0===e&&(e="uint128"),i.blob(8,e)},exports.isPositionsAccount=$,exports.isTicksAccount=ne,exports.isTokenSwapAccount=ae,exports.maxAmountA=x,exports.maxAmountB=P,exports.parsePositionsAccount=ee,exports.parseTicksAccount=re,exports.parseTokenAccount=We,exports.parseTokenAccountData=function(e){var t=u.AccountLayout.decode(e);return t.mint=new o.PublicKey(t.mint),t.owner=new o.PublicKey(t.owner),t.amount=u.u64.fromBuffer(t.amount),0===t.delegateOption?(t.delegate=null,t.delegatedAmount=new u.u64(0)):(t.delegate=new o.PublicKey(t.delegate),t.delegatedAmount=u.u64.fromBuffer(t.delegatedAmount)),t.isInitialized=0!==t.state,t.isFrozen=2===t.state,1===t.isNativeOption?(t.rentExemptReserve=u.u64.fromBuffer(t.isNative),t.isNative=!0):(t.rentExemptReserve=null,t.isNative=!1),t.closeAuthority=0===t.closeAuthorityOption?null:new o.PublicKey(t.closeAuthority),t},exports.parseTokenSwapAccount=ue,exports.price2Tick=g,exports.publicKey=V,exports.sendAndConfirmTransaction=Ke,exports.sqrtPrice2Tick=b,exports.swapA2B=O,exports.swapB2A=K,exports.tick2Price=function(e){return e>=-443632&&e<=443632||r(!1),d.pow(e)},exports.tick2SqrtPrice=v,exports.uint128=function(e){return void 0===e&&(e="uint128"),i.blob(16,e)},exports.uint64=function(e){return void 0===e&&(e="uint128"),i.blob(8,e)},exports.url=xe,exports.urlTls=Pe,exports.walletUrl=Oe;
//# sourceMappingURL=crema-sdk.cjs.production.min.js.map
